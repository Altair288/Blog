---
layout: post
title: 金蝶云星空旗舰版-演示数据账套的创建
date: 2025-01-15
Author: 
categories: 
tags: [Kingdee]
comments: false
toc: true
---


# 创建数据库实例

## 1. 下载演示中心数据

访问地址：

https://vip.kingdee.com/article/489817422015440128?productLineId=40&isKnowledge=2&lang=zh-CN

下载符合私有云布署平台的演示中心数据。没特殊要求，下载最新日期的。

![PixPin_2025-01-14_21-29-02](https://share.altair288.eu.org/easyimage/i/2025/01/14/z87dkv.jpg)

下载后的文件是个zip文件

## 2. 确定master节点

在安装时会要求指定哪个服务器为master。如下图：

![0100b7151bb42018477ab960a8cf716c48d3](https://share.altair288.eu.org/easyimage/i/2025/01/14/z9fvvb.png)

## 3. 拷贝演示数据中心数据到master节点

将下载的演示数据中心文件进行解压，将解压后的文件拷贝到私有云的布署集群的master节点中的/tmp文件夹下。

![010006a7d49a13274fa7b2ec680b0ca8f678](https://share.altair288.eu.org/easyimage/i/2025/01/14/z9ogy6.png)

## 4. 登陆master节点

ssh登陆到私有云的master节点。

## 5. 切换到用户

将当前用户切换到galaxyship

```shell
sudo su – galaxyship
```

## 6. 进行文件授权

```shell
#给kubernetes的配置文件授可读权限
sudo chmod +r /etc/kubernetes/admin.conf
#给baseline_show.backup授权可读权限
sudo chmod +r /tmp/baseline_show.backup
```

![01008478cd245c5945aabe45f550a44973cd](https://share.altair288.eu.org/easyimage/i/2025/01/14/zau8yo.png)

## 7. 将文件拷贝到容器内

```shell
kubectl cp /tmp/baseline_show.backup  pg-system/kd-cosmic-1:/var/lib/postgresql/data
```
![0100e6d80cd3965c43f489d2aa63a27a5183](https://share.altair288.eu.org/easyimage/i/2025/01/14/zaufor.png)

## 8. 进入容器

```shell
kubectl exec -it -n pg-system kd-cosmic-1 -- bash
```

![0100912ef5527ea4481fb016d18bda128189](https://share.altair288.eu.org/easyimage/i/2025/01/14/zauj9w.png)

## 9. 进入到数据库备份文件所在文件夹

```shell
cd /var/lib/postgresql/data
```

![0100efc6a8dd4db5486788854f70aff0916f](https://share.altair288.eu.org/easyimage/i/2025/01/14/zbugse.png)


## 10. 确认文件在容器内

```shell
ls
```

![01000f4cb17f687e4a18a726c0acc626ad32](https://share.altair288.eu.org/easyimage/i/2025/01/14/zdk2wl.png)

## 11. 设置需要还原的新的库的实例名称

比如需要将演示中心的数据备份文件还原成名称叫xk_demo_all的实例。则执行以下命令。

```shell
instance_db=xk_demo_all
```

![01004fefff3e303a42b097c9aaa24064f745](https://share.altair288.eu.org/easyimage/i/2025/01/14/zbug8d.png)


## 12. 设置其它的默认变量

```shell
#在容器中设置相关变量
#数据库备份文件的名称
dumpName=baseline_show.backup
#将要生成的toc文件的名称   toc文件是还原过程中需要生成的一个文件
tocName=baseline_show.toc
#还原的新的数据库拥有者  这个不需要修改，默认即可
adminUser=cosmic
```

![010017167ff54f4e4e8f963a0cc3d07b7b0e](https://share.altair288.eu.org/easyimage/i/2025/01/14/zbus2h.png)

## 13. 创建数据库

```shell
#创建数据库
psql   -d postgres -c "create database ${instance_db} encoding utf8 owner ${adminUser}"
```

![0100ca58870049b04bc09b468bbf79253d29](https://share.altair288.eu.org/easyimage/i/2025/01/14/zepyaz.png)

## 14. 生成toc文件

Toc文件是数据库还原过程中需要的一个文件，通过以下命令生成

```shell
pg_restore  -l  ${dumpName} > ${tocName}
```

![01001b1fe25e5be240fbb1952dd2afefbaca](https://share.altair288.eu.org/easyimage/i/2025/01/14/zeq1zp.png)

## 15. 确认生成了toc文件

```shell
ls
```

![010026555ccff4904c6e8fd0a9d3b0096579](https://share.altair288.eu.org/easyimage/i/2025/01/14/zf1kg4.png)

## 16. 进行数据库还原

```shell
pg_restore    -j 8  -d ${instance_db} -c --if-exists -L  ${tocName} --no-owner --role ${adminUser} $dumpName -v 1>/dev/null
```

![01005a49c1f430d747638ff4ae829db21cf3](https://share.altair288.eu.org/easyimage/i/2025/01/14/zfhk2w.png)