---
layout: post
title: 第十七课
date: 2023-06-02
Author: 
categories: 
tags: [eNSP]
comments: false
toc: true
---

# STP配置实验

## 一、实验目的：

- 理解交换机中STP协议的作用。
- 掌握配置、查看STP信息的方法。
- 掌握修改桥优先级，控制根桥选举的方法
- 掌握修改端口优先级，控制根端口和指定端口选举的方法。
- 掌握修改端口开销，控制根端口和指定端口选举的方法。

## 二、实验环境

- 配置网卡的计算机。
- 交换机。

## 三、实验内容

- 配置STP协议。
- 配置桥优先级，控制根桥选举。
- 配置端口优先级，控制根端口和指定端口选举。
- 配置端口开销，控制根端口和指定端口选举。

## 四、相关知识

STP简介

- 在企业网络中，为了提高网络可靠性，交换网络中通常会使用冗余链路。交换机之间通过多条链路互连时，虽然能够提升网络可靠性，但同时也会带来环路问题。环路会引起广播风暴、网络中的主机会收到重复数据帧、环路会引起MAC地址表震荡。
- STP通过阻塞端口来消除环路，并能够实现链路备份的目的。
- STP协议通过交换机之间交换BPDU，完成以下工作。
- 选举一个根桥。
- 每个非根交换机选举一个根端口。 Root Port
- 每个网段选举一个指定端口。 Designated Port
- 阻塞非根、非指定端口。 Alternate Port
- 从而消除环路。

## 五、实验范例

### 1、实验场景

- 作为公司的网络管理员,为了避免网络中的环路问题，需要在网络中的交换机上配置STP。本实验中，还需要通过修改桥优先级来控制STP的根桥选举。

### 2、实验网络拓扑图

- 实验拓扑中，两台交换机相连，构成了网络环路

[![pCPpLm8.jpg](https://s1.ax1x.com/2023/06/05/pCPpLm8.jpg)](https://imgse.com/i/pCPpLm8)

### 3、实验步骤

(1)配置STP并验证
- 本实验中，SW1和SW2之间有两条链路。在SW1和SW2上启用STP，并把SW1配置为根桥。
- SW1配置步骤如下：

```shell
<Huawei>
<Huawei>sys
[Huawei]sys SW1
[SW1]undo info en
配置STP模式为标准STP，华为设备默认启动MSTP
[SW1]stp mode stp
配置SW1为根交换机primary(优先级为0)
[SW1]stp root pri
```

- SW2配置步骤如下：

```shell
<Huawei>sys
[Huawei]sys SW2
[SW2]undo info en
[SW2]stp mode stp
配置SW1为备份根交换机secondary(优先级为4096)
[SW2]stp root sec
```

- SW1执行display stp brief命令查看STP信息。

```shell
在SW1执行display stp brief命令查看STP基本信息。
[SW1]dis stp b
 MSTID  Port                        Role  STP State     Protection
   0    GigabitEthernet0/0/9        DESI  FORWARDING      NONE
   0    GigabitEthernet0/0/10       DESI  FORWARDING      NONE
角色Role：DESI=Designated指定端口，ROOT=Root根端口，ALTE=Alternate预备端口
状态STP State：FORWARDING转发、DISCARDING阻塞、LEARNING学习
```

- SW2执行display stp brief命令查看STP信息。

```shell
